# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

# PresidioPDF Project Configuration

## Overview
This project is a **Japanese personal information detection and masking tool for PDF documents** using Microsoft Presidio. Dependencies are managed using **uv**.

## Package Management
- **Package Manager**: `uv` is used for dependency management
- **Add new dependencies**: `uv add <package-name>`
- **Add development dependencies**: `uv add --dev <package-name>`
- **Sync dependencies**: `uv sync`
- **Run commands**: `uv run <command>` or activate virtual environment

## Remark!
- Don't use desktop-commander unless the user specifically requests it.

## Project Structure
```
PresidioPDF/
â”œâ”€â”€ CLAUDE.md              # This file (Claude project configuration)
â”œâ”€â”€ .claude/               # Claude AI documentation structure
â”‚   â”œâ”€â”€ 00_project/        # Project requirements and overview
â”‚   â”œâ”€â”€ 01_development_docs/ # Technical design documents
â”‚   â”œâ”€â”€ 02_design_system/  # Design system documentation
â”‚   â””â”€â”€ 03_library_docs/   # Library strategies and dependencies
â”œâ”€â”€ pyproject.toml         # Project configuration and uv dependencies
â”œâ”€â”€ uv.lock               # Lock file (auto-generated by uv)
â”œâ”€â”€ .venv/                # Virtual environment (auto-created by uv)
â”œâ”€â”€ .mcp.json             # MCP server configuration
â”œâ”€â”€ config/               # Configuration files directory
â”‚   â”œâ”€â”€ config.yaml       # Main application configuration
â”‚   â”œâ”€â”€ config_template.yaml  # Configuration template
â”‚   â””â”€â”€ test_config.yaml  # Test configuration
â”œâ”€â”€ src/                  # Source code
â”‚   â”œâ”€â”€ core/             # Core functionality
â”‚   â”œâ”€â”€ nlp/              # NLP processing modules
â”‚   â”œâ”€â”€ pdf/              # PDF processing modules
â”‚   â”œâ”€â”€ web/              # Web application modules
â”‚   â”œâ”€â”€ templates/        # HTML templates
â”‚   â”œâ”€â”€ static/           # Static web assets
â”‚   â””â”€â”€ outputs/          # Output processing
â”œâ”€â”€ tests/                # Test files
â”œâ”€â”€ test_pdfs/            # Test PDF files
â”œâ”€â”€ data/                 # Data files
â”œâ”€â”€ outputs/              # Generated output files
â”œâ”€â”€ web_uploads/          # Web app upload directory
â”œâ”€â”€ archives/             # Archive files
â””â”€â”€ build/                # Build artifacts
```

## Optional Dependencies
The project supports multiple installation modes:
- **Default (CPU)**: Basic functionality with CPU-only models
- **GPU**: Enhanced performance with GPU-optimized models
- **Minimal**: Lightweight installation for basic PDF processing
- **Web**: Web application dependencies
- **GUI**: Desktop GUI dependencies
- **Dev**: Development and testing tools

## Core Architecture

The project implements a modular PDF PII detection and masking system with two main execution modes:

### Entry Points
- **CLI Mode**: `src/cli.py` - Command-line interface with comprehensive options
- **Web Mode**: `src/web_main.py` - Flask web application with GUI

### Core Components
- **PDFProcessor** (`src/pdf_processor.py`): Main orchestrator handling workflow coordination
- **Analyzer** (`src/analyzer.py`): Presidio-based PII detection with Japanese NLP models
- **PDFMasker** (`src/pdf_masker.py`): PyMuPDF-based text masking operations
- **PDFAnnotator** (`src/pdf_annotator.py`): Annotation/highlight management for PDFs
- **PDFTextLocator** (`src/pdf_locator.py`): Text coordinate location within PDF documents
- **ConfigManager** (`src/config_manager.py`): YAML-based configuration with CLI override support

### Processing Modes
1. **Detection & Masking**: Standard PII detection and masking workflow
2. **Read Mode**: Extract existing annotations/highlights from PDFs (`--read-mode`)
3. **Restore Mode**: Restore annotations from saved reports (`--restore-mode`)

### Multi-Model Support
The system supports different spaCy Japanese models via optional dependencies:
- `ja-core-news-sm`: Lightweight model (default/minimal)
- `ja-core-news-md`: Medium accuracy model
- `ja-core-news-lg`: High accuracy model (GPU optional)
- `ja-core-news-trf`: Transformer-based model (highest accuracy, requires transformers)

## Development Workflow
1. **Setup**: `uv sync` to install project dependencies
2. **Development**: Edit code, then run with `uv run <script>`
3. **Quality Check**: `uv run black . && uv run mypy src/ && uv run pytest --cov=src` for comprehensive quality validation
4. **Testing**: `uv run pytest` for running tests
5. **Linting**: `uv run black .` for code formatting
6. **Type checking**: `uv run mypy src/` for type verification

## Quality Standards
- **Zero Warning Policy**: All warnings are treated as errors and must be fixed
- **Strict Type Safety**: mypy type checking is mandatory, avoid `Any` types
- **Test-Driven Development**: Write tests before implementing features
- **Coverage Requirement**: Maintain 80%+ test coverage

## Instructions for Claude
- Always use `uv` commands for package management
- Do NOT use `pip` - this project exclusively uses uv
- When adding new dependencies, check `pyproject.toml` for appropriate optional dependency groups
- The virtual environment is automatically created in `.venv/` directory
- Work from the project root directory
- This is a Japanese NLP project focusing on PII detection in PDFs
- The project uses spaCy with Japanese models for text processing
- Web interface is available via Flask application
- **Command availability troubleshooting:**
  - If a command is not found on Windows, use `where <command>` to check location
  - If a command is not found on Linux/Unix, use `which <command>` to check location
  - Note: `uv` may be installed in user-specific paths like `/home/user/.local/bin/uv` (Linux) or `%USERPROFILE%\.local\bin\uv` (Windows)
  - If `uv` is not in PATH, you may need to use the full path or add it to environment variables

## Serena Token Optimization

### Token Usage Guidelines
To optimize Serena MCP server token consumption and avoid usage limits:

1. **Use Phased Analysis Approach**:
   - **Phase 1**: Start with `get_symbols_overview` for high-level understanding
   - **Phase 2**: Use `find_symbol` with `include_body=False` to identify targets
   - **Phase 3**: Only read full code bodies (`include_body=True`) when necessary

2. **Configure Response Limits**:
   - Set `max_answer_chars` parameter to control response size
   - Use smaller values (e.g., 50000-100000) for initial exploration
   - Increase only when detailed analysis is required

3. **Target Specific Analysis**:
   - Use `relative_path` parameter to restrict searches to specific files/directories
   - Prefer `find_symbol` over broad `search_for_pattern` when symbol names are known
   - Use `substring_matching=True` only when necessary

4. **Efficient Code Reading Strategy**:
   - AVOID reading entire files unless absolutely necessary
   - Use symbolic tools to read only required code sections
   - Leverage `depth` parameter to control symbol hierarchy depth

5. **File Exclusion Configuration**:
   - Configure `.serena/project.yml` with `ignored_paths` for non-essential directories
   - Set `ignore_all_files_in_gitignore: true` to exclude build artifacts
   - Exclude test files, documentation, and build outputs when not relevant

## Configuration Management

The application uses YAML configuration files with CLI override support:

### Primary Config Files
- `config/config.yaml`: Main application configuration 
- `config/config_template.yaml`: Configuration template file
- `config/test_config.yaml`: Test-specific configuration

### Key Configuration Sections
- `nlp.spacy_model`: Japanese spaCy model selection
- `pdf_masking_method`: Choose 'annotation', 'highlight', or 'both'
- `entities`: Enable/disable specific PII entity types
- `output_settings`: Control output paths and backup behavior
- `features.logging`: Logging level and output configuration

### Override Priority (highest to lowest)
1. CLI arguments (`--spacy-model`, `--masking-method`, etc.)
2. Custom config file (`--config custom.yaml`)
3. Default config file (`config/config.yaml`)
4. Built-in defaults

## Important Files
- `pyproject.toml`: Project configuration and dependency definitions with optional extras
- `uv.lock`: Dependency lock file (version pinning)
- `config/config.yaml`: Main application configuration file
- `src/web_main.py`: Web application entry point
- `src/cli.py`: Command-line interface entry point
- `src/pdf_processor.py`: Main processing orchestrator
- `src/static/js/app.js`: Frontend JavaScript with PDF.js integration
- `src/templates/index.html`: Main web UI template

## Common Commands

### Project Setup
```bash
# Project initialization
uv sync

# Install optional dependencies
uv sync --extra dev        # Development tools
uv sync --extra gpu        # GPU-optimized models
uv sync --extra web        # Web application
uv sync --extra gui        # Desktop GUI
```

### New CLI Commands (Specification Format)
```bash
# Read PDF and extract text with coordinate mapping
uv run python -m src.cli.read_main --pdf input.pdf --out read_output.json --with-map --pretty

# Read existing highlights from PDF
uv run python -m src.cli.read_main --pdf input.pdf --out read_output.json --with-highlights --pretty

# Detect PII from read output with specification format
uv run python -m src.cli.detect_main -j read_output.json --out detect_output.json --with-predetect --pretty

# Process duplicates with entity-aware mode
uv run python -m src.cli.duplicate_main -j detect_output.json --out final_output.json --entity-overlap-mode same --pretty

# Apply masking with coordinate map embedding
uv run python -m src.cli.mask_main --pdf input.pdf --json final_output.json --out masked.pdf --embed-coordinates
```

### Legacy CLI (Deprecated)
```bash
# Legacy unified CLI (still available but deprecated)
uv run python -m src.cli path/to/file.pdf
uv run python -m src.cli path/to/file.pdf --read-mode
uv run python -m src.cli path/to/file.pdf --restore-mode --report-file report.json
uv run python -m src.cli path/to/file.pdf --config config/config.yaml --spacy-model ja-core-news-lg
```

### Web Application
```bash
# Run web application
uv run python src/web_main.py
uv run python src/web_main.py --gpu --port 8080
```

### Testing
```bash
uv run pytest                    # Run all tests
uv run pytest tests/test_*.py   # Run specific test files
uv run pytest -v               # Verbose test output
uv run pytest --cov=src       # Run with coverage

# Test new features
uv run pytest tests/test_new_spec_format.py      # Test new JSON format
uv run pytest tests/test_new_cli_options.py      # Test new CLI options
uv run pytest tests/test_coordinate_mapping.py   # Test coordinate mapping
uv run pytest tests/test_pdf_embedding.py        # Test PDF embedding
```

### Code Quality
```bash
uv run black .                  # Format all code
uv run black src/              # Format specific directory
uv run mypy src/               # Type check source code
uv run mypy src/pdf_processor.py  # Type check specific file
```

### Dependency Management
```bash
uv tree                        # Show dependency tree
uv sync                        # Sync dependencies
uv sync --extra dev           # Install with dev dependencies
uv sync --extra gpu           # Install with GPU support
uv add package-name           # Add new dependency
uv add --dev pytest-mock      # Add dev dependency
```

### Environment Management
```bash
uv shell                       # Enter virtual environment shell
```

## New Specification Features

### JSON Format Changes
The specification introduces a new simplified JSON format:

**Key Changes:**
- `text`: Now 2D array format `[["page0_block0", "page0_block1"], ["page1_block0"]]`
- `detect`: Flat array with `start`/`end` as `{page_num, block_num, offset}` objects
- `offset2coordsMap`: Maps page/block positions to coordinate arrays
- `coords2offsetMap`: Maps coordinates to position tuples

### New CLI Options

**read_main.py:**
- `--with-map/--no-map`: Include coordinate mapping data (default: True)
- `--with-highlights`: Include existing PDF highlights in detect field

**detect_main.py:**
- `--with-predetect/--no-predetect`: Include existing detect information from input (default: True)

**duplicate_main.py:**
- `--entity-overlap-mode`: Control entity type consideration in duplicate processing
  - `same`: Only same entity types are considered for overlap (default)
  - `any`: Different entity types can also be considered for overlap

**mask_main.py:**
- `--embed-coordinates/--no-embed-coordinates`: Embed coordinate mapping data in output PDF (default: False)

### Coordinate Map Embedding
The new specification supports embedding coordinate maps directly in PDFs:

```bash
# Embed coordinate maps during masking
uv run python -m src.cli.mask_main --pdf input.pdf --json detect.json --out output.pdf --embed-coordinates

# Read embedded coordinate maps
uv run python -m src.cli.read_main --pdf output.pdf --out result.json --with-map
```

This allows processed PDFs to carry their coordinate mapping data for later use.

## Automated Web Testing

### web_app_test.py (tests/web_app_test.py)
æ”¹è‰¯ã•ã‚ŒãŸWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çµ±åˆãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã€‚ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚„ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºçŠ¶æ…‹ã‚’æ¤œå‡ºã—ã¦é©åˆ‡ã«å¾…æ©Ÿã—ã¾ã™ã€‚

**ä¸»ãªæ”¹è‰¯ç‚¹:**
- **ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼æ¤œå‡º**: ãã‚‹ãã‚‹ãƒãƒ¼ã‚¯ï¼ˆã‚¹ãƒ”ãƒŠãƒ¼ï¼‰ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹é–“ã¯å¾…æ©Ÿãƒ»å†æ’®å½±
- **ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºçŠ¶æ…‹æ¤œå‡º**: ã€ŒæŠ½å‡ºä¸­ã€ã€Œå‡¦ç†ä¸­ã€ç­‰ã®ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚‹é–“ã¯å¾…æ©Ÿ
- **ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆå†è©¦è¡Œ**: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚’æ¤œå‡ºã—ãŸå ´åˆã¯è‡ªå‹•ã§å†æ’®å½±
- **å ´æ‰€ç§»å‹•**: `tests/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®

**å®Ÿè¡Œæ–¹æ³•:**
```bash
# 1. å‰ææ¡ä»¶ï¼šFlask ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
uv run python src/web_main.py &

# 2. ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
uv run python tests/web_app_test.py
```

**ãƒ†ã‚¹ãƒˆæ‰‹é †ï¼ˆæ”¹è‰¯ç‰ˆï¼‰:**
1. **ã‚µãƒ¼ãƒãƒ¼ç¢ºèª**: Flask ã‚µãƒ¼ãƒãƒ¼ï¼ˆlocalhost:5000ï¼‰ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
2. **ãƒ–ãƒ©ã‚¦ã‚¶ã‚¢ã‚¯ã‚»ã‚¹**: Playwrightï¼ˆãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ¢ãƒ¼ãƒ‰ï¼‰ã§localhost:5000ã«ã‚¢ã‚¯ã‚»ã‚¹
3. **åˆæœŸã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ**: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Œäº†ã‚’å¾…æ©Ÿã—ã¦ã‹ã‚‰æ’®å½±
4. **PDFã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: test_pdfs/sony.pdf ã‚’WebUIã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
5. **ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ**: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦æ’®å½±
6. **PIIæ¤œå‡ºå®Ÿè¡Œ**: ã€Œæ¤œå‡ºé–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å‡¦ç†å®Œäº†ã¾ã§å¾…æ©Ÿ
7. **æ¤œå‡ºå®Œäº†ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ**: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ãƒ”ãƒŠãƒ¼æ¶ˆå¤±ã‚’ç¢ºèªã—ã¦æ’®å½±
8. **ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡º**: ã€ŒæŠ½å‡ºä¸­ã€ç­‰ã®æ–‡å­—ãŒæ¶ˆãˆã‚‹ã¾ã§å¾…æ©Ÿã—ã¦ã‹ã‚‰ãƒ†ã‚­ã‚¹ãƒˆå–å¾—
9. **PDFä¿å­˜ã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**: ã€ŒPDFã‚’ä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒã‚¹ã‚­ãƒ³ã‚°æ¸ˆã¿PDFã‚’ç”Ÿæˆãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
10. **ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰PDFç¢ºèª**: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸPDFã‚’æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã„ã¦ãƒã‚¤ãƒ©ã‚¤ãƒˆçŠ¶æ…‹ã‚’ç¢ºèª
11. **æœ€çµ‚ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ**: å…¨ãƒšãƒ¼ã‚¸ãƒ»PDFãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰PDFã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæ’®å½±

**æ”¹è‰¯ã•ã‚ŒãŸæ¤œå‡ºæ©Ÿèƒ½:**
- `.spinner-border`, `.loading`, `#loadingOverlay`, `.fa-spinner` ç­‰ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´ ã‚’æ¤œå‡º
- ã€ŒæŠ½å‡ºä¸­ã€ã€Œå‡¦ç†ä¸­ã€ã€Œèª­ã¿è¾¼ã¿ä¸­ã€ã€Œè§£æä¸­ã€ã€Œæ¤œå‡ºä¸­ã€ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ç›£è¦–
- æœ€å¤§3å›ã®å†è©¦è¡Œã§ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚’å›é¿ã—ãŸã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæ’®å½±

**å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«:**
- `/workspace/outputs/detection_results_text.txt`: æ¤œå‡ºçµæœã®ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
- `/workspace/outputs/*.png`: å„æ®µéšã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ
  - `01_initial_page.png`: åˆæœŸãƒšãƒ¼ã‚¸ï¼ˆãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Œäº†å¾Œï¼‰
  - `02_after_upload.png`: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œï¼ˆãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Œäº†å¾Œï¼‰
  - `03_after_detection.png`: æ¤œå‡ºå‡¦ç†å®Œäº†å¾Œï¼ˆãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Œäº†å¾Œï¼‰
  - `04_full_page_with_highlights.png`: ãƒ•ãƒ«ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼
  - `05_pdf_viewer_highlights.png`: PDFãƒ“ãƒ¥ãƒ¼ã‚¢ï¼ˆãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºï¼‰
  - `06_downloaded_pdf_with_highlights.png`: ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸPDFã®è¡¨ç¤ºç¢ºèª
  - `06_pdf_error_screenshot.png`: PDFç¢ºèªæ™‚ã®ã‚¨ãƒ©ãƒ¼ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ã®ã¿ï¼‰

### webui-integration-testï¼ˆãƒ¬ã‚¬ã‚·ãƒ¼ç‰ˆï¼‰
Full web application integration test routine that performs end-to-end testing of the PII detection web interface:

1. **Process Check**: Check if localhost:5000 is running and kill any existing processes
2. **Server Start**: Launch Flask server with `src/web_main.py` on localhost:5000 (run in background or with timeout since server doesn't return control)
3. **Browser Access**: Use Playwright to access localhost:5000
4. **File Upload**: Upload specified PDF file using the upload button
5. **Model Selection**: Select specified spaCy model (defaults to "ja-core-news-sm" if not specified)
6. **Detection**: Click the detection button to process the PDF
7. **Results Save**: Save detected personal information list to `output/` directory with specified filename
8. **Screenshot**: Take page screenshot and save to `output/` directory with same name as results but different extension

This test routine validates the complete web application workflow from file upload to PII detection results.

### web_app_test
MCPã‚µãƒ¼ãƒãƒ¼ã®Playwrightãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ãŸå®Œå…¨ãªçµ±åˆãƒ†ã‚¹ãƒˆã€‚ä»¥ä¸‹ã®æ‰‹é †ã§å®Ÿè¡Œï¼š

**å®Ÿè¡Œæ–¹æ³•:**
```bash
# 1. å‰ææ¡ä»¶ï¼šFlask ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
uv run python src/web_main.py &

# 2. ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
uv run python web_app_test.py
```

**ãƒ†ã‚¹ãƒˆæ‰‹é †:**
1. **ã‚µãƒ¼ãƒãƒ¼ç¢ºèª**: Flask ã‚µãƒ¼ãƒãƒ¼ï¼ˆlocalhost:5000ï¼‰ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
2. **ãƒ–ãƒ©ã‚¦ã‚¶ã‚¢ã‚¯ã‚»ã‚¹**: Playwrightï¼ˆãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ¢ãƒ¼ãƒ‰ï¼‰ã§localhost:5000ã«ã‚¢ã‚¯ã‚»ã‚¹
3. **PDFã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: test_pdfs/å†…ã®PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’WebUIã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
4. **æ¡ä»¶è¨­å®š**: spaCyãƒ¢ãƒ‡ãƒ«é¸æŠç­‰ã®è¨­å®šï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
5. **PIIæ¤œå‡ºå®Ÿè¡Œ**: å€‹äººæƒ…å ±æ¤œå‡ºãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å‡¦ç†å®Œäº†ã¾ã§å¾…æ©Ÿ
6. **çµæœå–å¾—**: Ctrl+Aã§å…¨é¸æŠã—ã¦ãƒšãƒ¼ã‚¸ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
7. **ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ**: è¤‡æ•°ç®‡æ‰€ã§ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®å½±ã—ã¦PIIãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’ç¢ºèª

**å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«:**
- `/workspace/outputs/detection_results_text.txt`: æ¤œå‡ºçµæœã®ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
- `/workspace/outputs/*.png`: å„æ®µéšã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ
  - `01_initial_page.png`: åˆæœŸãƒšãƒ¼ã‚¸
  - `02_after_upload.png`: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œ
  - `03_after_detection.png`: æ¤œå‡ºå‡¦ç†å®Œäº†å¾Œ
  - `04_full_page_with_highlights.png`: ãƒ•ãƒ«ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼
  - `05_pdf_viewer_highlights.png`: PDFãƒ“ãƒ¥ãƒ¼ã‚¢ï¼ˆãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºï¼‰

ã“ã®ãƒ†ã‚¹ãƒˆã«ã‚ˆã‚Šã€WebUIã®æ“ä½œã‹ã‚‰PIIæ¤œå‡ºã€çµæœè¡¨ç¤ºã¾ã§ã®å®Œå…¨ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è‡ªå‹•ã§æ¤œè¨¼ã§ãã¾ã™ã€‚

## Comprehensive Documentation Structure

This project includes extensive documentation organized into four main categories:

### ğŸ“‹ Project Documentation (`.claude/00_project/`)
- `01_project_overview.md`: Complete project overview and architecture
- `02_inception_deck.md`: Strategic project vision, users, and success metrics

### ğŸ”§ Development Documentation (`.claude/01_development_docs/`)
- `03_database_design.md`: Data management strategies using YAML/JSON
- `04_api_design.md`: REST API and internal service architecture  
- `05_screen_transition_design.md`: Web UI navigation and flow patterns
- `06_seo_requirements.md`: Search engine optimization strategy
- `07_error_handling_design.md`: Comprehensive error management patterns
- `08_type_definitions.md`: Python type system and Pydantic validation
- `09_development_setup.md`: Development environment configuration guide
- `10_test_strategy.md`: Testing approaches and frameworks
- `11_frontend_design.md`: Flask web UI architecture and patterns
- `12_cicd_design.md`: CI/CD pipeline design with GitHub Actions
- `13_e2e_test_design.md`: End-to-end testing with Playwright
- `14_security_design.md`: Security architecture and threat mitigation
- `15_performance_optimization.md`: Performance tuning strategies
- `16_performance_monitoring.md`: Monitoring and alerting systems

### ğŸ¨ Design System Documentation (`.claude/02_design_system/`)
- `00_basic_design.md`: Core design system foundation with CSS variables
- `01_design_principles.md`: Design philosophy and user-centered guidelines
- `02_component_design.md`: Complete UI component library (atoms to templates)
- `03_animation_system.md`: Motion design and animation patterns
- `04_layout_system.md`: Responsive grid and layout systems

### ğŸ“š Library Integration Documentation (`.claude/03_library_docs/`)
- `02_presidio_integration_guide.md`: Microsoft Presidio setup and Japanese PII detection
- `03_spacy_model_testing.md`: spaCy Japanese model comparison and testing strategies
- `04_pymupdf_patterns.md`: PyMuPDF optimization patterns and advanced PDF processing

### ğŸ“– How to Use This Documentation

**For New Team Members:**
1. Start with `00_project/01_project_overview.md` for project understanding
2. Review `00_project/02_inception_deck.md` for strategic context
3. Follow `01_development_docs/09_development_setup.md` for environment setup

**For Development:**
- Consult design system docs before implementing UI components
- Reference library docs for optimal usage patterns
- Follow error handling and type definition guidelines

**For Architecture Decisions:**
- Review security and performance documentation
- Consult API design patterns for new endpoints
- Follow established testing strategies

**Quick Reference Links:**
- [Project Overview](.claude/00_project/01_project_overview.md)
- [Development Setup](.claude/01_development_docs/09_development_setup.md) 
- [Component Library](.claude/02_design_system/02_component_design.md)
- [Presidio Integration](.claude/03_library_docs/02_presidio_integration_guide.md)
- [Testing Strategy](.claude/01_development_docs/10_test_strategy.md)