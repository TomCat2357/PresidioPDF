#仕様
##共通
PII情報については、システム上では基本的にplainテキストベースで管理する。
管理するPII情報は、PII情報毎のstart(page_num,block_num,offset)及びend(page_num,block_num,offset)、entityの種類、検出した単語、検出したorigin(auto,手動、追加）とする。
pdfでは、ハイライト（注釈）情報として取り扱い、座標（形式はweb系のコードを参照）と、entityの種類、検出した単語となる。その他、一度処理したpdfには、座標⇔文字オフセット情報の変換マップを埋め込む。すなわち、左側矢印としては{page_num:{block_num:[[x0,y0,x1,y1],[x0,y0,x1,y1],[x0,y0,x1,y1],...],[...],...]}}のdictionary(json)であり、右側矢印としては、{(x0,y0,x1,y1):(page_num,block_num,offset),....}のdictionary(json)とする。なお、page_num,block_num,offsetは0スタートとし、endについても実際のoffset+1ではなく、実際のoffsetとする。

##read
readはpdfを読み込むものであり、
①--with-mapがあれば、添付ファイルの変換mapがあればそれを読み取る（デフォルトはこのフラグあり）。逆に--no-map又は変換マップが添付されていない場合は、pdfから変換マップを作成する。
②--with-highlightsがあれば、ハイライトを読み込む。読み込んだハイライトは①の変換マップを使って、文字オフセット情報に変換する。下記④のJSON出力の"detect"キーのvalueを参照
③従来はstructured_textを読み込んでいたが、それは廃止する。（なぜならばplain textで管理するから）
④ＪＳＯＮ出力は{"metadata":{..},"text":[["xxxx","yyyyyyyy"],["zzzz","aaa",..."],....],"detect":[{"start":{"page_num":0,"block_num":0,"offset":0},"end":{"page_num":0,"block_num":0,"offset":3},"entity":"PERSON","word":"田中守男"},{..},...],"offset2coordsMap":{...},"coords2offsetMap":{...}}とする。
⑤他の機能は上記①から④に矛盾しない限り従前どおり。矛盾したらそれに①～④に合わせる

##detect
readの出力json（以下「read_json」という。）からPII情報を検出し、jsonで出力するものである。
まずはread_jsonの"text"キーの値について、ページ、ブロック全てを結合したfull_plain_textを作る。これについてanalyzerでPII情報を検出する。この時点では、full_plain_text上のstartとendのoffsetとentity種類と検出単語とoriginの情報が得られている。これをpage_num,block_num,offsetに変換する必要があるため、textキーの値の構造から計算して作成してdetect情報を作成する。
--with-predetect（旧オプション名--add-highlights)のときは、read_jsonの"detect"情報に今のdetect情報を追加する。その反対フラグ--no-predetect又はread_jsonにdetectキーの値がない場合は、今のdetect情報をそのまま採用する。
detectのjson出力は{"metadata":{...},"detect":[...],"offset2coordsMap":{...},"coords2offsetMap":{...}}である。

##duplicate
detectの出力json（以下「detect_json」という。）の情報の重複処理を行う。基本的には従前どおりだが、追加オプションとして、エンティティが違っても重複とするモードと重複としないモードの別を追加してほしい。すなわち、重複とするモードは"PERSON"と"ADDRESS"についても、重複処理を行うものであり、重複としないモードはそもそも違うエンティティについては、重なっていたとしても重複処理を行わないものとする。
json出力形式は{"metadata":{...},"detect":[...],"offset2coordsMap":{...},"coords2offsetMap":{...}}である。

##pdf
基本的には従前と同じであるが、{"offset2coordsMap":{...},"coords2offsetMap":{...}}をpdfに埋め込む処理を追加する



